<!DOCTYPE >
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"  />
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="format-detection" content="telephone=no" />
		<title>设备列表</title>
		<link type="text/css" rel="stylesheet" href="../css/common.css" />
		<link type="text/css" rel="stylesheet" href="../css/style.css" />
		<link type="text/css" rel="stylesheet" href="../css/popup.css" />

		<script type="text/javascript" src="../js/jquery.min.js"></script>
		<script type="text/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
		<script type="text/javascript">
			wx.config({
				debug : false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
				appId : 'wx7c65f52480327c2c', // 必填，公众号的唯一标识
				timestamp : '1502951047', // 必填，生成签名的时间戳
				nonceStr : 'f516dfb84b9051ed85b89cdc3a8ab7f5', // 必填，生成签名的随机串
				signature : '1b3cefd76482047d696ded8684e4edfe7fa23e84', // 必填，签名，见附录1
				jsApiList : ['checkJsApi', 'onMenuShareTimeline', 'onMenuShareAppMessage', 'onMenuShareQQ', 'onMenuShareWeibo', 'hideMenuItems', 'showMenuItems', 'hideAllNonBaseMenuItem', 'showAllNonBaseMenuItem', 'translateVoice', 'startRecord', 'stopRecord', 'onRecordEnd', 'playVoice', 'pauseVoice', 'stopVoice', 'uploadVoice', 'downloadVoice', 'chooseImage', 'previewImage', 'uploadImage', 'downloadImage', 'getNetworkType', 'openLocation', 'getLocation', 'hideOptionMenu', 'showOptionMenu', 'closeWindow', 'scanQRCode', 'chooseWXPay', 'openProductSpecificView', 'addCard', 'chooseCard', 'openCard', 'openWXDeviceLib', 'closeWXDeviceLib', 'configWXDeviceWiFi', 'getWXDeviceInfos', 'sendDataToWXDevice', 'startScanWXDevice', 'stopScanWXDevice', 'connectWXDevice', 'disconnectWXDevice', 'getWXDeviceTicket', 'WeixinJSBridgeReady', 'onWXDeviceBindStateChange', 'onWXDeviceStateChange', 'onScanWXDeviceResult', 'onReceiveDataFromWXDevice', 'onWXDeviceBluetoothStateChange'] // 必填，需要使用的JS接口列表，所有JS接口列表见附录2
			});

			wx.ready(function() {
				wx.hideAllNonBaseMenuItem();
			});
		</script>
	</head>
	<body  style="background:#088e85;">
		<div id="deviceList" style="padding-bottom:48px;"></div>

		<!--底部工具栏-->
		<div class="toolbar" id="toolbatButton">
			<div class="add_equipment">
				<p>
					添加设备
				</p>
				<button data-modal="equipment_add"  class="md-trigger"></button>
			</div>
			<div class="offline_description">
				<p>
					离线说明
				</p>
				<button data-modal="offline_description"  class="md-trigger"></button>
			</div>
		</div>

		<!--添加设备弹窗开始-->
		<div class="md-modal md-effect-1" id="equipment_add">
			<div class="md-content more_popup">
				<p class="more_popup_title">
					添加设备
				</p>
				<p class="connection_network" style="text-align: center;">
					长按图片识别二维码
				</p>
				<div style="text-align: center; margin-top:5px">
					<img id="productQrCode" style="width:260px;" src="http://wx.yuntongkeji.com/res/img/qrcode.jpg">
				</div>
				<div class="popup_button_1">
					<button class="md-close next">
						关闭
					</button>
				</div>
			</div>
		</div>
		<!--添加设备弹窗结束-->

		<!--离线说明弹窗开始-->
		<div class="md-modal md-effect-1" id="offline_description">
			<div class="md-content more_popup">
				<p class="more_popup_title">
					离线说明
				</p>
				<p class="offline_description_font">
					若设备显示“离线”状态，请按以下说明排查原因，重新建立微信与硬件的连接。
				</p>
				<ul class="offline_description_ul" onclick="openDetail()">
					<li>
						检查硬件是否断电。
					</li>
					<li>
						检查路由器WiFi是否能正常连接。
					</li>
					<li>
						监测仪只支持2.4G频段WiFi信号
					</li>
					<li>
						查看监测仪MAC地址是否被路由器限制。
					</li>
					<li>
						以上正常可尝试重新配置网络。
					</li>
				</ul>
				<div class="popup_button_1">
					<button class="md-close next">
						返回
					</button>
				</div>
			</div>
		</div>
		<!--离线说明弹窗结束-->

		<!--弹窗的黑色透明背景-->
		<div class="md-overlay"></div>

	</body>
	<!--弹窗JS-->
	<script type="text/javascript" src="../js/popup/classie.js"></script>
	<script type="text/javascript" src="../js/popup/modalEffects.js"></script>
	<script type="text/javascript" src="../js/doT.min.js"></script>
	<script id="itemTemp" type="text/x-dot-template">
		{{ for(var i = 0;i<it.length;i++){ }}
		<div class="equipment_list" data-id="{{=it[i].id}}" onclick="openDetail(this)">
		<img class="equipment_list_icon" src="../images/equipment_list_icon.png">
		<div class="equipment_content">
		<p class="equipment_name">{{=it[i].name}}</p>
		<p class="equipment_number">{{=it[i].stationId}}</p>
		<p class="equipment_online">在线</p>
		</div>
		<div class="pm_content">
		<p class="pm_units">浓度</p>
		<p class="pm_number">{{=it[i].NongD}}</p>
		</div>
		<div class="clear"></div>
		<img class="equipment_list_arrow" src="../images/equipment_list_arrow.png">
		</div>
		{{ } }}
	</script>
	<script type="text/javascript">
		$(function() {
			$.ajax({
				type : "get",
				dataType : "json",
				url : "http://bjepex.oicp.net:8520/ch2/servlet/LoginAction",
				data : {
					parameter4 : 2
				},
				success : function(data) {
					var list = data.list;
					var dataText = doT.template($("#itemTemp").text());
					$("#deviceList").html(dataText(list));
				},
				error : function(e) {
					console.log(e);
				}
			});
		});
		// 点击列表跳转详情， 将id传递过去
		function openDetail(item) {
			var id = $(item).attr("data-id");
			var href = '../html/detail.html?id=' + id;
			window.location.href = href;
		}
	</script>
</html>